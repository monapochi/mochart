# Mochart 競合分析 & ギャップ解消プラン

> 作成日: 2026-02-14
> 対象ライバル: TradingView (Lightweight Charts), GoCharting, Highstock, SC.DX

---

## 1. 現状の実装完了度

### 完了済み (✅)
- Canvas レンダラ (ローソク足描画, Y/X軸, クロスヘア, ツールチップ, レジェンド)
- WebGL2 / WebGPU レンダラ (スケルトン)
- インディケーター Phase 1-4 (CPU): SMA, EMA, BB, RSI, ADX, ATR, MACD, VWAP, Vol_Ratio, %B, BB_Width, OBV, CMF, MFI, Kaufman, Divergence, Squeeze
- インディケーター (GPU WGSL): SMA, EMA, BB, RSI, ATR, MACD, ADX, VWAP 等
- トレードマーカー (shape, instanced)
- アラートランタイム API + クールダウン
- i18n (nameKey + 文字列テーブル)
- Embed API (create, connectFeed, destroy, on/off)
- Mac トラックパッド対応 (ピンチズーム / 2フィンガーパン / スムーズスクロール)
- Y軸オートスケール (価格単位パディング)
- 右余白 (最新端到達時のみ)
- ポインタドラッグによるパン

### 未実装 (❌) — ライバルが標準搭載するもの
以下が主要な不足点。

---

## 2. ライバル比較マトリクス

| 機能カテゴリ | TradingView LWC | GoCharting | Highstock | Mochart (現状) |
|---|---|---|---|---|
| **チャートタイプ** | ローソク, ライン, エリア, ハイロー, バー | 同左 + レンコ, 平均足, P&F | 多数 | ローソクのみ ❌ |
| **マルチペイン** | サブチャート 自動配置 | 自由配置 | 固定配置 | 未実装 ❌ |
| **時間軸** | タイムスケール + ビジネス時間 | 同左 | 同左 | インデックスのみ ❌ |
| **描画ツール** | トレンドライン, フィボ, チャネル等 | 同左 + Gann | 基本のみ | 未実装 ❌ |
| **リアルタイム** | WebSocket ストリーミング | 同左 | polling | Feed API あり (未テスト) |
| **レスポンシブ** | ResizeObserver + 自動再描画 | 同左 | 同左 | 未実装 ❌ |
| **テーマ** | Light / Dark 切り替え | 同左 + カスタム | CSS | 未実装 ❌ |
| **価格スケール** | 対数 / 線形 / 百分率 | 同左 | 同左 | 線形のみ ❌ |
| **クロスヘア** | スナップ + 価格ラベル | 同左 | 同左 | 基本実装 △ |
| **キーボード操作** | ← → ズーム パン | 同左 | 同左 | 未実装 ❌ |
| **印刷 / エクスポート** | PNG / SVG | 同左 | 同左 | 未実装 ❌ |
| **インディケーター描画** | 自動サブペイン + オーバーレイ | 同左 | 同左 | レジストリのみ (描画未接続) ❌ |
| **ウォーターマーク** | テキスト / ロゴ | なし | あり | 未実装 ❌ |
| **アクセシビリティ** | ARIA + フォーカス管理 | 部分的 | 部分的 | 未実装 ❌ |
| **モバイル最適化** | タッチ最適化 + DPR | 同左 | 同左 | 基本的なタッチ対応 △ |
| **パフォーマンス** | Canvas 2D (最適化済み) | WebGL | SVG/Canvas | Canvas 2D △ |
| **バンドルサイズ** | ~45KB gzip | ~200KB | ~300KB | 未計測 ❌ |

---

## 3. ギャップ解消プラン (優先度順)

### Phase A: 基盤品質 (最優先 — これなしでは使い物にならない)

| # | タスク | 理由 | 工数目安 |
|---|---|---|---|
| A1 | **ResizeObserver 対応** | ウィンドウリサイズでチャートが壊れる | S |
| A2 | **DPR (devicePixelRatio) 対応の強化** | Retina で文字ボケ, 座標ずれ | S |
| A3 | **ライン / エリアチャートタイプ** | ローソク以外が表示不能 | M |
| A4 | **インディケーター描画パイプライン接続** | 計算済みデータの可視化 (オーバーレイ + サブペイン) | L |
| A5 | **時間軸スケール** | インデックス→時刻表示, 営業日スキップ | M |
| A6 | **テーマ (Light / Dark)** | 最低限の見た目切り替え | S |

### Phase B: 操作性 (ユーザーが "使える" と感じるレベル)

| # | タスク | 理由 | 工数目安 |
|---|---|---|---|
| B1 | **キーボードショートカット** | ← → でパン, +/- でズーム, Home/End | S |
| B2 | **価格スケール切り替え** | 対数 / パーセント / 線形 | M |
| B3 | **マルチペイン レイアウト** | RSI, MACD 等をサブチャートに配置 | L |
| B4 | **クロスヘア改善** | 全ペイン同期, 価格ラベル常時表示 | M |
| B5 | **ツールチップ改善** | フォーマットカスタマイズ, 複数系列対応 | S |
| B6 | **スナップショット (PNG エクスポート)** | toDataURL ベースの画像書き出し | S |

### Phase C: 差別化 (ライバルに並ぶ → 超える)

| # | タスク | 理由 | 工数目安 |
|---|---|---|---|
| C1 | **WebGPU 描画パイプライン本格稼働** | 10年分 + 10インディケーター同時でも 60fps | L |
| C2 | **GPU バッチ Compute 実行** | 全インディケーターを1パスで計算 | L |
| C3 | **描画ツール (トレンドライン, フィボナッチ)** | 分析必須機能 | L |
| C4 | **リアルタイムストリーミング統合テスト** | WebSocket 経由での pushRealtime 実証 | M |
| C5 | **バンドルサイズ最適化** | Tree-shaking, コードスプリット, < 50KB gzip 目標 | M |
| C6 | **ウォーターマーク** | ブランディング | S |
| C7 | **アクセシビリティ (ARIA)** | 企業向け必須要件 | M |

### Phase D: 拡張 (将来の武器)

| # | タスク | 理由 | 工数目安 |
|---|---|---|---|
| D1 | **カスタムインディケーター UI** | ユーザーが独自指標をエディタで追加 | L |
| D2 | **アラート UI** | 発火アラートの通知パネル | M |
| D3 | **比較チャート** | 複数シンボルを同一ペインに重ねる | M |
| D4 | **平均足 / レンコ / P&F** | 特殊チャートタイプ | M |
| D5 | **プラグイン API** | サードパーティ拡張用フック | L |

---

## 4. Mochart の武器 (現時点の差別化要素)

ライバルに無い / 弱い点で Mochart が攻められるポイント:

1. **WebGPU-First**: TradingView LWC は Canvas 2D のみ。GPU Compute + GPU Render の統合パイプラインが実現すれば、大量データでの圧倒的パフォーマンスが武器になる。
2. **GPU インディケーター計算**: WGSL Compute によるリアルタイム指標計算は他に無い。10年分のデータにバッチ計算して 1ms 以下が狙える。
3. **TypeScript ネイティブ**: LWC も TS だが、Mochart は指標定義からテストまで完全 TS ファースト。
4. **アラート/シグナル統合**: チャートライブラリ本体にアラートランタイムが組み込まれているのはユニーク。
5. **軽量設計**: embed API + 遅延 import で、SSR フレームワーク (Next.js, SolidStart) との統合が容易。
6. **Cache-Friendly SoA データ**: AoS Object[] (1 bar ≈ 80B + GC 管理) → SoA Float32Array (1 bar = 24B 連続メモリ)。L1 キャッシュライン (64B) に 16 float が乗るため、price scan / min-max / LTTB が SIMD auto-vectorize される。100万本データでもワーキングセットが L2 (数MB) に収まり、ライバル対比でメモリ消費 ~70% 減。バンドルも < 50KB gzip (core) を目標とし、TradingView LWC (~45KB) と同等以下を狙う。

---

## 5. 推奨ロードマップ

```
2026-02  Phase A (基盤品質) ━━━━━━━━━━━━━━━━━━━━━┓
         A1 ResizeObserver                        ┃
         A2 DPR 強化                              ┃
         A3 ライン/エリアチャート                   ┃
         A6 テーマ                                 ┃
                                                  ┃
2026-03  A4 インディケーター描画接続 ━━━━━━━━━━━━━━┛
         A5 時間軸スケール
         Phase B (操作性) ━━━━━━━━━━━━━━━━━━━━━━━┓
         B1 キーボード                             ┃
         B3 マルチペイン                            ┃
         B4 クロスヘア改善                          ┃
                                                  ┃
2026-04  B2 価格スケール切り替え ━━━━━━━━━━━━━━━━━┛
         B5 ツールチップ改善
         B6 PNG エクスポート
         Phase C (差別化) ━━━━━━━━━━━━━━━━━━━━━━━┓
         C1 WebGPU 描画パイプライン                 ┃
         C2 GPU バッチ Compute                     ┃
                                                  ┃
2026-05  C3 描画ツール ━━━━━━━━━━━━━━━━━━━━━━━━━━┛
         C4 リアルタイム統合
         C5 バンドルサイズ最適化

2026-06+ Phase D (拡張)
```

---

## 6. 最優先で着手すべき 5 項目

現状から最も効果的な改善順:

1. **A4: インディケーター描画パイプライン接続** — 計算エンジンは完成済みなのに可視化できていない。繋ぐだけで "チャートライブラリ" としての機能が一気に充実する。
2. **B3: マルチペイン レイアウト** — RSI, MACD をサブチャートに出せないと指標ライブラリの意味がない。
3. **A1 + A2: ResizeObserver + DPR** — Web アプリ組み込み時の基本品質。小さいが impact 大。
4. **A3: ライン / エリアチャート** — 指標描画にも必要 (SMA はライン, Volume はバー)。A4 の前提。
5. **A6: テーマ** — Dark テーマは最低限のプロ感。変数化だけなら工数小。

---

## 7. PLAN.md との対応

| PLAN.md の項目 | 本ドキュメントの対応 |
|---|---|
| batched GPU compute | C2 |
| unit test 拡充 | 継続 (各フェーズで追加) |
| アラート UI | D2 |
| 言語切替 UI | B フェーズで対応 |

PLAN.md に無かった重要項目: A1-A6, B1-B6, C3, C5 を追加。
